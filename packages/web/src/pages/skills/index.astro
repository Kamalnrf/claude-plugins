---
import Badge from "@/components/Badge.astro";
import { PluginOrSkillsTabSwitcher } from "@/components/PluginOrSkillsTabSwitcher";
import SkillBrowser from "@/components/SkillBrowser";
import MarketplaceLayout from "@/layouts/MarketplaceLayout.astro";
import { registryAPI } from "@/lib/api";

// Get search params from URL
const url = new URL(Astro.request.url);
const searchQuery = url.searchParams.get("q") || "";
const orderBy = url.searchParams.get("orderBy") as "downloads" | "stars" | null;
const order = url.searchParams.get("order") as "asc" | "desc" | null;

// Fetch initial skills with SSR
const { skills, total } = await registryAPI.searchSkills({
	q: searchQuery,
	limit: 20,
	offset: 0,
	...(orderBy && { orderBy }),
	...(order && { order }),
});
---

<MarketplaceLayout
  title="Discover Claude Skills",
  description={`Discover and install Claude Skills from across GitHub. Auto-indexed, openâ€‘source, and communityâ€‘maintained, search ${total}+ skills, track downloads, and quickly add capabilities to Claude/ Claude Code.`}
>
  <div class="px-4 py-4 md:px-6 md:py-6 flex flex-col gap-6">
    <PluginOrSkillsTabSwitcher transition:persist client:load selectedTab="skills" />
    <section class="flex flex-col gap-5" transition:animate="fade" transition:name="hero">
      <div class="flex flex-col gap-2.5">
        <h1 class="text-2xl font-serif font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent">
          Discover Claude Skills
        </h1>
        <p class="text-base text-muted-foreground/80 leading-relaxed break-words">
          Discover and Install <strong>Claude skills</strong> quickly.
          All public skills in Github are auto-indexed and made available for quickly discovering and installing.
          <a href="https://github.com/Kamalnrf/claude-plugins" class="underline hover:text-primary">Open-source</a> and community-maintained.
        </p>
      </div>

      <!-- Built with badges -->
      <div class="flex items-center gap-2.5 text-xs text-muted-foreground/60">
        <span class="font-medium">built with</span>
        <div class="flex items-center gap-1.5">
          <Badge href="https://www.val.town/x/kamalnrf/claude-plugins-registry">Val Town</Badge>
          <Badge variant="dotted">Claude Code ðŸ˜‰</Badge>
        </div>
      </div>
    </section>
    <SkillBrowser initialQuery={searchQuery} initialSkills={skills} total={total} initialOrderBy={orderBy} initialOrder={order} client:load />
  </div>
</MarketplaceLayout>
